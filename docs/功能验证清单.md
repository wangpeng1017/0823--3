# 功能验证清单

## 🔐 安全配置验证

### ✅ API密钥安全配置
- [x] Google API密钥已配置到 `.env.local`
- [x] `.env.local` 已添加到 `.gitignore`
- [x] 密钥格式验证通过 (AIza开头，36字符)
- [x] 环境变量模板 `.env.example` 已更新
- [x] 安全检查脚本已创建

### 🔍 安全检查命令
```bash
# 检查当前暂存的文件
npm run security-check

# 检查所有项目文件
npm run security-check:full

# Git提交前检查
npm run pre-commit
```

## 🧪 OCR功能验证

### 1. 环境准备验证
```bash
# 运行OCR测试脚本
npm run test-ocr
```

**预期结果:**
- ✅ Google API Key 已正确配置
- ✅ API密钥格式正确
- ✅ Gemini API连接成功
- ✅ OCR相关文件存在
- ✅ 安全配置检查通过

### 2. 开发服务器启动
```bash
# 启动开发服务器
npm run dev
```

**验证步骤:**
1. 访问 http://localhost:3000
2. 确认应用正常启动
3. 检查控制台无错误信息

### 3. 用户认证测试
**步骤:**
1. 访问 http://localhost:3000/dashboard
2. 应该重定向到登录页面
3. 点击"使用飞书登录"按钮
4. 完成飞书OAuth认证流程

**预期结果:**
- 成功跳转到飞书授权页面
- 授权后返回到dashboard页面
- 显示用户信息

### 4. OCR功能测试

#### 4.1 访问OCR测试页面
```
URL: http://localhost:3000/test-ocr
```

#### 4.2 基础文字识别测试
**测试步骤:**
1. 选择"基础文字识别"模式
2. 上传包含清晰文字的图片
3. 点击"开始文字识别测试"
4. 等待处理完成

**预期结果:**
- 成功识别图片中的文字
- 返回识别的文本内容
- 显示置信度和处理时间
- 无错误信息

**测试用例:**
- 📄 文档截图
- 📝 手写文字照片
- 📊 包含表格的图片
- 🔤 中英文混合文本

#### 4.3 合同信息提取测试
**测试步骤:**
1. 选择"合同信息提取"模式
2. 上传合同文档图片
3. 勾选"生成替换规则"
4. 点击"开始合同信息提取测试"

**预期结果:**
- 成功提取合同关键信息
- 返回结构化数据 (JSON格式)
- 包含甲方、乙方、金额等字段
- 生成相应的替换规则

**测试合同图片应包含:**
- 甲方公司名称
- 乙方公司名称
- 合同金额
- 合同编号
- 签署日期
- 联系人信息

### 5. API端点测试

#### 5.1 基础OCR API测试
```bash
curl -X POST http://localhost:3000/api/ocr/extract \
  -H "Cookie: access_token=your_token" \
  -F "image=@test-image.jpg" \
  -F "extractStructured=false" \
  -F "language=zh-CN"
```

#### 5.2 合同提取API测试
```bash
curl -X POST http://localhost:3000/api/ocr/contract \
  -H "Cookie: access_token=your_token" \
  -F "image=@contract-image.jpg" \
  -F "generateRules=true"
```

## 🔧 技术验证

### 1. 代码质量检查
```bash
# TypeScript类型检查
npm run type-check

# ESLint代码检查
npm run lint

# 安全检查
npm run security-check:full
```

### 2. 构建测试
```bash
# 生产构建测试
npm run build

# 启动生产服务器
npm start
```

### 3. 环境变量验证
**检查项目:**
- [x] `.env.local` 包含正确的API密钥
- [x] `.env.example` 提供配置模板
- [x] `.gitignore` 排除敏感文件
- [x] 代码中使用 `process.env.GOOGLE_API_KEY`

## 📊 性能验证

### OCR性能指标
**基础文字识别:**
- 响应时间: < 5秒
- 识别准确率: > 95%
- 支持文件大小: ≤ 10MB

**合同信息提取:**
- 响应时间: < 8秒
- 信息提取准确率: > 90%
- 结构化数据完整性: > 85%

### 测试记录表格
| 测试项目 | 预期结果 | 实际结果 | 状态 | 备注 |
|---------|---------|---------|------|------|
| API密钥配置 | 正确配置 | ✅ | 通过 | |
| 安全检查 | 无敏感信息泄露 | ✅ | 通过 | |
| 基础OCR | 文字识别成功 | | 待测试 | |
| 合同提取 | 信息提取成功 | | 待测试 | |
| API响应 | 正常返回数据 | | 待测试 | |

## 🚨 故障排除

### 常见问题及解决方案

#### 1. API密钥错误
**症状:** OCR请求返回401或403错误
**解决方案:**
1. 检查 `.env.local` 中的 `GOOGLE_API_KEY`
2. 确认密钥格式正确 (AIza开头)
3. 验证密钥在Google AI Studio中有效

#### 2. 文件上传失败
**症状:** 图片上传后无响应或报错
**解决方案:**
1. 检查文件大小 (≤ 10MB)
2. 确认文件格式 (JPEG, PNG, GIF, WebP)
3. 检查网络连接

#### 3. OCR识别效果差
**症状:** 识别文字不准确或缺失
**解决方案:**
1. 使用更清晰的图片
2. 确保光线充足
3. 避免图片倾斜或模糊
4. 尝试不同的图片格式

#### 4. 认证失败
**症状:** 无法访问OCR功能
**解决方案:**
1. 确认已完成飞书登录
2. 检查access_token是否有效
3. 重新登录获取新token

## ✅ 验证完成确认

完成所有验证后，请确认以下项目：

### 安全配置 ✅
- [ ] API密钥安全存储
- [ ] 敏感文件已排除Git
- [ ] 安全检查脚本正常工作
- [ ] 无硬编码密钥

### 功能验证 ✅
- [ ] 基础OCR功能正常
- [ ] 合同信息提取正常
- [ ] API端点响应正确
- [ ] 错误处理完善

### 性能验证 ✅
- [ ] 响应时间符合预期
- [ ] 识别准确率达标
- [ ] 文件处理稳定

### 代码质量 ✅
- [ ] TypeScript编译通过
- [ ] ESLint检查通过
- [ ] 构建测试成功

## 🎉 验证完成

当所有项目都通过验证后，OCR功能已准备就绪，可以进行下一阶段的开发工作！

---

**注意:** 请在每次代码提交前运行 `npm run pre-commit` 进行安全检查。
