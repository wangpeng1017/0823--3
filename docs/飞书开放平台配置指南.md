# 飞书开放平台配置指南

本文档将指导您如何在飞书开放平台创建企业自建应用，并获取必要的配置信息。

## 1. 前置准备

### 1.1 账号要求
- 拥有飞书企业管理员权限的账号
- 确保企业已开通飞书云文档功能

### 1.2 访问飞书开放平台
访问：[https://open.feishu.cn/](https://open.feishu.cn/)

## 2. 创建企业自建应用

### 2.1 登录开放平台
1. 使用飞书企业管理员账号登录
2. 选择对应的企业组织

### 2.2 创建应用
1. 点击"创建应用"按钮
2. 选择"企业自建应用"
3. 填写应用基本信息：
   - **应用名称**: 飞书合同内容更新助手
   - **应用描述**: 简化和自动化更新飞书云文档中的合同内容
   - **应用图标**: 上传应用图标（可选）

### 2.3 获取应用凭证
创建成功后，在应用详情页面可以看到：
- **App ID**: 应用的唯一标识符
- **App Secret**: 应用密钥（请妥善保管）

## 3. 配置应用权限

### 3.1 OAuth 权限配置
在"安全设置" → "重定向URL"中添加：
- 开发环境：`http://localhost:3000/api/auth/callback`
- 生产环境：`https://your-domain.com/api/auth/callback`

### 3.2 API 权限申请
在"权限管理"中申请以下权限：

#### 必需权限
- **获取用户基本信息** (`contact:user.base:readonly`)
- **获取用户身份信息** (`contact:user.id:readonly`)

#### 云文档权限
- **查看、评论、编辑和管理云文档** (`docx:document`)
- **查看云文档** (`docx:document:readonly`)
- **编辑云文档** (`docx:document:write`)

### 3.3 权限申请流程
1. 点击"申请权限"
2. 选择所需权限
3. 填写权限申请理由
4. 提交申请等待审核

## 4. 配置应用信息

### 4.1 应用基本信息
在"应用信息"页面完善：
- **应用简介**: 详细描述应用功能
- **应用类型**: 选择"工具类"
- **适用场景**: 文档处理、办公自动化

### 4.2 版本管理
1. 创建应用版本
2. 填写版本说明
3. 上传应用截图（可选）
4. 提交版本审核

## 5. 测试配置

### 5.1 获取测试用户授权
1. 在开发阶段，可以添加测试用户
2. 测试用户可以直接使用应用，无需等待审核

### 5.2 测试 OAuth 流程
使用以下 URL 测试授权流程：
```
https://open.feishu.cn/open-apis/authen/v1/authorize?app_id={APP_ID}&redirect_uri={REDIRECT_URI}&response_type=code&scope=contact:user.base:readonly+contact:user.id:readonly+docx:document
```

## 6. 环境变量配置

将获取的配置信息填入项目的环境变量：

```bash
# .env.local
FEISHU_APP_ID=cli_xxxxxxxxxxxxxxxxx
FEISHU_APP_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
FEISHU_REDIRECT_URI=http://localhost:3000/api/auth/callback
```

## 7. 常见问题

### 7.1 权限申请被拒绝
**原因**: 权限申请理由不充分或应用信息不完整
**解决**: 
- 完善应用描述和使用场景
- 详细说明权限使用目的
- 重新提交申请

### 7.2 回调地址配置错误
**原因**: 重定向URL配置不正确
**解决**:
- 确保回调地址与代码中配置一致
- 检查协议（http/https）是否正确
- 确认端口号是否匹配

### 7.3 应用审核时间过长
**原因**: 应用信息不完整或权限申请复杂
**解决**:
- 联系飞书开放平台客服
- 提供详细的应用说明文档
- 确保应用符合平台规范

## 8. 安全建议

### 8.1 密钥管理
- **不要**将 App Secret 硬编码在代码中
- 使用环境变量管理敏感信息
- 定期轮换应用密钥

### 8.2 权限最小化
- 只申请必要的权限
- 定期审查权限使用情况
- 及时移除不需要的权限

### 8.3 访问控制
- 限制应用的使用范围
- 监控应用的访问日志
- 设置合理的访问频率限制

## 9. 开发调试

### 9.1 API 调试工具
飞书开放平台提供了 API 调试工具，可以：
- 测试 API 调用
- 查看请求和响应数据
- 验证权限配置

### 9.2 日志查看
在应用管理后台可以查看：
- API 调用日志
- 错误日志
- 用户授权记录

## 10. 生产发布

### 10.1 应用发布前检查
- [ ] 所有权限已获得批准
- [ ] 应用信息完整准确
- [ ] 回调地址配置正确
- [ ] 安全设置已完善

### 10.2 发布流程
1. 完成应用开发和测试
2. 提交应用版本审核
3. 等待平台审核通过
4. 发布应用到企业内部

### 10.3 发布后维护
- 监控应用运行状态
- 及时处理用户反馈
- 定期更新应用版本

## 11. 相关链接

- [飞书开放平台官网](https://open.feishu.cn/)
- [飞书开放平台文档](https://open.feishu.cn/document/)
- [OAuth 2.0 接入指南](https://open.feishu.cn/document/ukTMukTMukTM/ukzN4UjL5cDO14SO3gTN)
- [云文档 API 文档](https://open.feishu.cn/document/ukTMukTMukTM/uUDN04SN0QjL1QDN/document-docx)

---

**注意**: 本指南基于飞书开放平台当前版本编写，如遇到界面或流程变化，请以官方最新文档为准。
